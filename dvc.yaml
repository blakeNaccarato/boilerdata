stages:
  schema:
    cmd: "python -m boilerdata.stages.schema"
    params:
      - "config/axes.yaml":
      - "config/project.yaml":
      - "config/trials.yaml":
    deps:
      # Will run at least twice due to schema_old changing after a successful run.
      # Avoids a dependency cycle but allows the schema to evolve.
      - "data/schema_old"
      - "src/boilerdata/stages/schema.py"
      - "src/boilerdata/models"
    outs:
      - "data/schema"
      # # DVC deletes outs before generating. Uncommenting the below breaks it.
      # - "src/boilerdata/axes_enum.py"

  runs:
    cmd: "python -m boilerdata.stages.runs"
    params:
      - "config/axes.yaml":
      - "config/project.yaml":
      - "config/trials.yaml":
    deps:
      # Allow other parts of boilerdata to change w/o re-running this stage
      - "src/boilerdata/stages/runs.py"
      - "data/schema"
      - "data/curves"
    outs: ["data/runs"]

  pipeline:
    cmd: "python -m boilerdata.stages.pipeline"
    params:
      - "config/axes.yaml":
      - "config/project.yaml":
      - "config/trials.yaml":
    deps:
      - "src/boilerdata" # Do re-run pipeline if anything in boilerdata changes
      - "data/schema"
      - "data/runs"
    outs: ["data/results"]
    plots:
      - "data/plots/first_new_fit.png"
      - "data/plots/last_new_fit.png"

  originlab:
    cmd: "python -m boilerdata.stages.originlab"
    deps:
      - "src/boilerdata"
      - "data/plotter"
      - "data/results"
    plots: ["data/plots/lit_.png"]
